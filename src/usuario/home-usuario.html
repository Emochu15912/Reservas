<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reserva de Canchas - Inicio</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <style>
    *, *::before, *::after { box-sizing: border-box; }
    body { margin:0; font-family: 'Montserrat', sans-serif; background: #e8f0fe; color: #1a237e; min-height:100vh; display:flex; flex-direction:column; }
    header { background-color: #1a237e; color: #fff; padding:1rem 2rem; display:flex; flex-wrap:wrap; justify-content:space-between; align-items:center; box-shadow:0 4px 15px rgba(26,35,126,0.5); }
    header h1 { font-size:1.6rem; font-weight:700; flex:1 1 200px; }
    .header-buttons { display:flex; gap:1rem; flex-wrap:wrap; }
    .header-buttons button { background: #ff7043; border:none; color:white; padding:0.55rem 1.2rem; border-radius:8px; cursor:pointer; font-weight:700; font-size:1rem; display:flex; align-items:center; gap:0.5rem; transition: background-color 0.3s ease; }
    .header-buttons button:hover { background:#f4511e; }
    .container { flex-grow:1; padding:2rem; max-width:1200px; margin:0 auto; width:100%; }
    .search-bar { margin-bottom:2rem; display:flex; justify-content:center; }
    .search-bar input { width:100%; max-width:600px; padding:0.9rem 1.2rem; font-size:1.1rem; border-radius:12px; border:2px solid #1a237e; box-shadow:0 4px 8px rgba(26,35,126,0.15); }
    .search-bar input:focus { border-color:#ff7043; outline:none; box-shadow:0 0 8px 2px rgba(255,112,67,0.5); }
    .grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(320px, 1fr)); gap:1.8rem; opacity:0; animation:fadeIn 0.8s forwards ease-in-out; }
    @keyframes fadeIn { to { opacity:1; } }
    .card { background:white; border-radius:20px; padding:1.5rem 1.8rem; box-shadow:0 10px 25px rgba(26,35,126,0.1); display:flex; flex-direction:column; transition: transform 0.25s ease, box-shadow 0.25s ease; position:relative; overflow:hidden; }
    .card:hover { transform:translateY(-6px); box-shadow:0 18px 30px rgba(255,112,67,0.35); }
    .card img { width:100%; height:180px; object-fit:cover; border-radius:15px; margin-bottom:1rem; transition: transform 0.3s ease; }
    .card img:hover { transform:scale(1.05); }
    .card h3 { margin:0 0 0.5rem 0; font-weight:700; font-size:1.4rem; color:#1a237e; }
    .card p { margin:0.3rem 0; font-size:1rem; color:#555; }
    .status { margin:1rem 0; font-weight:700; font-size:1.05rem; }
    .status.disponible { color:#388e3c; }
    .status.ocupada { color:#d32f2f; }
    .card button { background-color:#ff7043; border:none; padding:0.65rem 1.3rem; font-size:1.05rem; font-weight:700; border-radius:12px; color:white; cursor:pointer; align-self:flex-start; display:flex; align-items:center; gap:0.6rem; transition:background 0.3s ease; }
    .card button:disabled { background-color:#999; cursor:not-allowed; }
    .card button:hover:not(:disabled) { background-color:#f4511e; }
    footer { text-align:center; padding:1.8rem 1rem; font-size:0.9rem; color:#666; background:#fff; box-shadow:0 -2px 8px rgba(26,35,126,0.1); }
  </style>
</head>
<body>
  <header>
    <h1>Bienvenido, <span id="nombreUsuario">Usuario</span></h1>
    <nav class="header-buttons">
  <button id="btnMisReservas" onclick="irMisReservas()">
    <i class="fas fa-calendar-check"></i> Mis Reservas
  </button>
  <button id="btnPerfil" onclick="irPerfil()">
    <i class="fas fa-user-circle"></i> Perfil
  </button>
  <button id="btnLogout" onclick="cerrarSesion()">
    <i class="fas fa-sign-out-alt"></i> Cerrar sesión
  </button>
</nav>
  </header>

  <main class="container">
    <section class="search-bar">
      <input type="search" id="searchInput" placeholder="Buscar cancha..." />
    </section>

    <section id="contenedorCanchas" class="grid">
      <!-- Tarjetas se insertan aquí -->
    </section>
  </main>

  <footer>
    © 2025 HEPSU - Todos los derechos reservados.
  </footer>

  <!-- Firebase v10 compat -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
  <script src="../common/js/firebase-config.js"></script>

  <script>
    const app = firebase.app();
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Mostrar nombre del usuario y redirigir según rol
    auth.onAuthStateChanged(async user=>{
      if(!user) { window.location.href='index.html'; return; }

      const doc = await db.collection('usuarios').doc(user.uid).get();
      const data = doc.exists ? doc.data() : {};
      const rol = data.rol || 'usuario';

      document.getElementById('nombreUsuario').textContent = data.nombre || user.email || 'Usuario';

      // Si admin abre esta página, redirige al panel admin
      if(rol==='admin') window.location.href='admin.html';
    });

    // Función para cargar canchas
    async function cargarCanchas() {
      const contenedor = document.getElementById('contenedorCanchas');
      contenedor.innerHTML='';
      try {
        const snapshot = await db.collection('canchas').get();
        snapshot.forEach(doc=>{
          const data = doc.data();
          const disponible = data.disponibilidad ? 'Disponible' : 'Ocupada';
          const estadoClass = data.disponibilidad ? 'disponible' : 'ocupada';
          const imgUrl = data.imagen || 'https://via.placeholder.com/400x180?text=Sin+Imagen';
          const precioDia = data.precioDia || '0.00';
          const precioNoche = data.precioNoche || '0.00';

          const card = document.createElement('div');
          card.className='card';
          card.innerHTML=`
            <img src="${imgUrl}" alt="Imagen de ${data.nombre||'Cancha'}" />
            <h3>${data.nombre||'Cancha sin nombre'}</h3>
            <p><strong>Tipo:</strong> ${data.tipo||'Desconocido'}</p>
            <p><strong>Precio Día:</strong> S/ ${precioDia}</p>
            <p><strong>Precio Noche:</strong> S/ ${precioNoche}</p>
            <p class="status ${estadoClass}">${disponible}</p>
            <button ${!data.disponibilidad?'disabled':''} onclick="reservar('${doc.id}')">
              <i class="fas fa-calendar-plus"></i> Reservar
            </button>
          `;
          contenedor.appendChild(card);
        });
      } catch(err) { console.error(err); contenedor.innerHTML='<p>No se pudieron cargar las canchas.</p>'; }
    }

    function reservar(idCancha){
      sessionStorage.setItem('canchaId', idCancha);
      window.location.href='reservar.html';
    }

    function irMisReservas() {
  window.location.href = 'mis-reservas.html';
}

function irPerfil() {
  window.location.href = 'mis-reservas.html';
}

async function cerrarSesion() {
  try {
    await firebase.auth().signOut();
    window.location.href = 'index.html';
  } catch(err) {
    console.error('Error al cerrar sesión:', err);
    alert('No se pudo cerrar sesión. Intenta de nuevo.');
  }
}

    // Búsqueda
    document.getElementById('searchInput').addEventListener('input', function(){
      const term=this.value.toLowerCase();
      document.querySelectorAll('.card').forEach(card=>{
        const nombre = card.querySelector('h3').textContent.toLowerCase();
        card.style.display = nombre.includes(term)?'flex':'none';
      });
    });

    window.onload=cargarCanchas;
  </script>
</body>
</html>
